<html>

<head>
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="bootstrap/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css"/>
    <link href="style.css" rel="stylesheet" type="text/css" />
</head>

<body>
    <div class="container" id="topLevelContainer">
        <div class="col-xs-12 col-md-2" id="navBar">
            <a class="btn btn-primary col-xs-2 col-md-12" href="index.html">Tech Tree</a>
            <a class="btn btn-primary col-xs-2 col-md-12" href="objects.html">Objects</a>
            <a class="btn btn-primary col-xs-2 col-md-12" href="items.html">Items</a>
            <a class="disabled btn btn-primary col-xs-2 col-md-12" href="npcs.html">NPCs</a>
            <a class="disabled btn btn-primary col-xs-2 col-md-12" href="tags.html">Tags</a>
        </div>
        <div class="container col-xs-12 col-md-10">
            <div class="col-xs-12">
                <h1 id="title"></h1>
            </div>
            <div class="col-xs-12 col-md-3" id="general">
                <p id="image"/>
                <p>ID: <span id="id"/></span>
            </div>
            <div class="col-xs-12 col-md-3" id="gathering">
                <h3>Gathering</h3>
                <p id="gatherReq"></p>
                <p id="gatherTime"></p>
                <p id="yield"></p>
                <ul id="yieldList"></ul>
            </div>
            <div class="col-xs-12 col-md-3" id="construction">
                <h3>Construction</h3>
                <p id="constructionReq"></p>
                <p id="constructionTime"></p>
            </div>
            <div class="col-xs-12 col-md-3" id="transformation">
                <h3>Transformation</h3>
                <p id="transformTarget"></p>
                <p id="transformTime"></p>
            </div>
            <div class="col-xs-12 col-md-3" id="unlocks">
                <h3>Locked</h3>
                <p>Construction can be unlocked by:</p>
                <ul id="unlockList"></ul>
            </div>
        </div>
    </div>
    
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script type="text/javascript" src="items.js"></script>
    <script type="text/javascript" src="objects.js"></script>
    <script type="text/javascript" src="util.js"></script>
    <script type="text/javascript">
        $(document).ready(function(){
            var obj = findObject();
            
            console.log(obj);
            document.title = obj.name;
            $("#title").html(obj.name);
            $("#id").html(obj.id);
            $("#image").html(imageNode(obj));
            
            // Gathering
            if (!("gatherReq" in obj || "gatherTime" in obj || "yields" in obj))
                $("#gathering").hide();
            else {
                if ("gatherReq" in obj)
                    $("#gatherReq").html("Required tool: " + obj.gatherReq);
                if ("gatherTime" in obj)
                    $("#gatherTime").html("Takes " + displayTimeAsHMS(obj.gatherTime));
                if ("yield" in obj)
                    $("#yield").html("Yields:");
                for (var i = 0; i < obj.yield.length; ++i){
                    var yieldID = obj.yield[i];
                    var linkAddress = "item.html?id=" + yieldID;
                    var yieldItem = findItem(yieldID);
                    $("#yieldList").append( '<li><a href="' + linkAddress + '">' + imageNode(yieldItem) + yieldItem.name + "</a></li>" );
                }
            }
            
            // Construction
            if (!("constructionReq" in obj || "constructionTime" in obj))
                $("#construction").hide();
            else{
                if ("constructionReq" in obj)
                    $("#constructionReq").html("Required tool: " + obj.constructionReq);
                if ("constructionTime" in obj)
                    $("#constructionTime").html("Takes " + displayTimeAsHMS(obj.constructionTime));
            }
            
            // Transformation
            if (!("transformID" in obj))
                $("#transformation").hide();
            else{
                var futureObject = findObject(obj.transformID)
                console.log(futureObject);
                var linkAddress = "object.html?id=" + obj.transformID;
                var transformTargetHTML =
                        'Transforms into: <a href="' + linkAddress + '">'
                        + futureObject.name + imageNode(futureObject) + "</a>";
                $("#transformTarget").html(transformTargetHTML);
                if ("transformTime" in obj)
                    $("#transformTime").html("Takes " + displayTimeAsHMS(obj.transformTime));
            }
            
            
            // Unlocks
            if (!("unlocks" in obj))
                $("#unlocks").hide();
            else{
                for (var i = 0; i < obj.unlocks.length; ++i){
                    var listItemHTML = compileUnlockListItem(obj.unlocks[i]);
                    $("#unlockList").append(listItemHTML);
                }
            }
            
        });

        var linkPageByType = {
            craft: "item",
            construct: "object",
            gather: "item",
            acquire: "item",
        };
        var prefixByType = {
            craft: "crafting ",
            construct: "constructing ",
            gather: "gathering ",
            acquire: "receiving "
        };
        var suffixByType = {
            craft: "",
            construct: "",
            gather: " from an object",
            acquire: " from any source",
        };
        function compileUnlockListItem(lock){
            console.log(lock);
            var source;
            if (linkPageByType[lock.type] == "item")
                source = findItem(lock.sourceID);
            else
                source = findObject(lock.sourceID);
            
            var linkAddress = linkPageByType[lock.type] + ".html?id=" + lock.sourceID;
            var listText =
                    '<li>' + prefixByType[lock.type]
                    + '<a href="' + linkAddress + '">' + source.name + '</a>'
                    + suffixByType[lock.type] +  '</li>';
            return listText;
        }
    </script>
</body>

</html>
